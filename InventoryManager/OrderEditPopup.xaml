<?xml version="1.0" encoding="utf-8" ?>
<!-- OrderEditPopup.xaml - Order Creation and Editing Popup -->
<!-- This follows the same modal popup pattern as AddItemPopup -->

<ContentPage x:Class="InventoryManager.OrderEditPopup"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Order Details"
             BackgroundColor="White">

    <ScrollView Padding="20">
        <VerticalStackLayout Spacing="20">

            <!-- Order Header Information -->
            <Border BackgroundColor="DarkBlue" 
                    StrokeShape="RoundRectangle 10"
                    Stroke="Transparent"
                    Padding="20">
                <VerticalStackLayout Spacing="15">

                    <Label x:Name="PageTitleLabel"
                           Text="Create New Order"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center" />

                    <!-- Order Name -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Order Name *"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White" />
                        <Entry x:Name="OrderNameEntry"
                               Placeholder="Enter order name..."
                               BackgroundColor="White"
                               TextColor="Black"
                               PlaceholderColor="Gray" />
                    </VerticalStackLayout>

                    <!-- Order Notes -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Notes"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White" />
                        <Editor x:Name="NotesEditor"
                                Placeholder="Optional notes about this order..."
                                BackgroundColor="White"
                                TextColor="Black"
                                HeightRequest="80" />
                    </VerticalStackLayout>

                    <!-- Order Status (for existing orders) -->
                    <StackLayout x:Name="StatusSection" IsVisible="False" Spacing="5">
                        <Label Text="Status"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White" />
                        <Border x:Name="StatusBorder"
                                BackgroundColor="Orange"
                                StrokeShape="RoundRectangle 8"
                                Stroke="Transparent"
                                Padding="10,5"
                                HorizontalOptions="Start">
                            <Label x:Name="StatusLabel"
                                   Text="Pending"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="White" />
                        </Border>
                    </StackLayout>

                </VerticalStackLayout>
            </Border>

            <!-- Order Items Section -->
            <Border BackgroundColor="WhiteSmoke" 
                    StrokeShape="RoundRectangle 10"
                    Stroke="LightGray"
                    Padding="15">
                <VerticalStackLayout Spacing="15">

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                        <Label Grid.Column="0"
                               Text="Order Items"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="DarkBlue" />

                        <Button Grid.Column="1"
                                x:Name="AddItemBtn"
                                Text="+ Add Item"
                                FontSize="12"
                                BackgroundColor="Green"
                                TextColor="White"
                                CornerRadius="5"
                                Padding="10,5"
                                Clicked="OnAddItemClicked" />
                    </Grid>

                    <!-- Items List -->
                    <StackLayout x:Name="OrderItemsContainer" Spacing="10">

                        <!-- Loading indicator for items -->
                        <ActivityIndicator x:Name="ItemsLoadingIndicator"
                                           IsVisible="False"
                                           IsRunning="False"
                                           Color="DarkBlue"
                                           HeightRequest="30" />

                        <!-- Items will be added here dynamically -->
                        <CollectionView x:Name="OrderItemsCollectionView"
                                        SelectionMode="None"
                                        BackgroundColor="Transparent">

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border BackgroundColor="White"
                                            StrokeShape="RoundRectangle 8"
                                            Stroke="LightGray"
                                            Padding="10"
                                            Margin="0,2">

                                        <Grid ColumnDefinitions="2*,*,*,Auto" 
                                              ColumnSpacing="10"
                                              RowDefinitions="Auto,Auto"
                                              RowSpacing="5">

                                            <!-- Item Name and Code -->
                                            <StackLayout Grid.Row="0" Grid.Column="0" Spacing="2">
                                                <Label Text="{Binding ItemName}" 
                                                       FontSize="14" 
                                                       FontAttributes="Bold"
                                                       TextColor="Black" />
                                                <Label Text="{Binding ItemCode}" 
                                                       FontSize="12" 
                                                       TextColor="Gray" />
                                            </StackLayout>

                                            <!-- Quantity -->
                                            <StackLayout Grid.Row="0" Grid.Column="1" Spacing="2">
                                                <Label Text="Qty:" 
                                                       FontSize="12" 
                                                       TextColor="Gray" />
                                                <Label Text="{Binding Quantity}" 
                                                       FontSize="14" 
                                                       FontAttributes="Bold"
                                                       TextColor="Black" />
                                            </StackLayout>

                                            <!-- Unit Cost -->
                                            <StackLayout Grid.Row="0" Grid.Column="2" Spacing="2">
                                                <Label Text="Cost:" 
                                                       FontSize="12" 
                                                       TextColor="Gray" />
                                                <Label Text="{Binding TotalValue, StringFormat='${0:F2}'}" 
                                                       FontSize="14" 
                                                       FontAttributes="Bold"
                                                       TextColor="Black" />
                                            </StackLayout>

                                            <!-- Remove Button -->
                                            <Button Grid.Row="0" Grid.Column="3"
                                                    Text="🗑️"
                                                    FontSize="14"
                                                    BackgroundColor="Red"
                                                    TextColor="White"
                                                    CornerRadius="4"
                                                    Padding="8,4"
                                                    Clicked="OnRemoveItemClicked"
                                                    CommandParameter="{Binding Id}" />

                                            <!-- Available Stock Info -->
                                            <Label Grid.Row="1" Grid.ColumnSpan="4"
                                                   Text="{Binding AvailableStock, StringFormat='Available in stock: {0}'}" 
                                                   FontSize="12" 
                                                   TextColor="Orange"
                                                   IsVisible="{Binding AvailableStock, Converter={StaticResource BoolToVisibilityConverter}}" />

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>

                            <!-- Empty state for no items -->
                            <CollectionView.EmptyView>
                                <StackLayout Padding="20" HorizontalOptions="Center">
                                    <Label Text="📦"
                                           FontSize="36"
                                           HorizontalOptions="Center"
                                           TextColor="Gray" />
                                    <Label Text="No items in this order"
                                           FontSize="14"
                                           HorizontalOptions="Center"
                                           TextColor="Gray" />
                                    <Label Text="Tap 'Add Item' to get started"
                                           FontSize="12"
                                           HorizontalOptions="Center"
                                           TextColor="LightGray"
                                           Margin="0,5,0,0" />
                                </StackLayout>
                            </CollectionView.EmptyView>

                        </CollectionView>

                    </StackLayout>

                    <!-- Order Summary -->
                    <Border x:Name="SummarySection"
                            BackgroundColor="LightBlue"
                            StrokeShape="RoundRectangle 8"
                            Stroke="Transparent"
                            Padding="15"
                            IsVisible="False">
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="20">

                            <StackLayout Grid.Column="0" Spacing="5">
                                <Label Text="Total Items"
                                       FontSize="12"
                                       TextColor="Gray" />
                                <Label x:Name="TotalItemsLabel"
                                       Text="0"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="DarkBlue" />
                            </StackLayout>

                            <StackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Total Value"
                                       FontSize="12"
                                       TextColor="Gray" />
                                <Label x:Name="TotalValueLabel"
                                       Text="$0.00"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="DarkBlue" />
                            </StackLayout>

                        </Grid>
                    </Border>

                </VerticalStackLayout>
            </Border>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="10">

                <!-- Save Button -->
                <Button x:Name="SaveBtn"
                        Text="Save Order"
                        FontSize="16"
                        BackgroundColor="DarkBlue"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="0,12"
                        Clicked="OnSaveClicked" />

                <!-- Finalize Button (only for existing pending orders) -->
                <Button x:Name="FinalizeBtn"
                        Text="✅ Finalize Order"
                        FontSize="16"
                        BackgroundColor="Green"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="0,12"
                        Clicked="OnFinalizeClicked"
                        IsVisible="False" />

                <!-- Delete Button (only for existing orders) -->
                <Button x:Name="DeleteBtn"
                        Text="🗑️ Delete Order"
                        FontSize="16"
                        BackgroundColor="Red"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="0,12"
                        Clicked="OnDeleteClicked"
                        IsVisible="False" />

                <!-- Cancel Button -->
                <Button x:Name="CancelBtn"
                        Text="Cancel"
                        FontSize="16"
                        BackgroundColor="Gray"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="0,12"
                        Clicked="OnCancelClicked" />

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>